{% extends "base.html" %}

{% block title %}로그인 / 회원가입 - 자동차 소음 이상 탐지{% endblock %}
{% block body_class %}page-md{% endblock %}

{% block content %}
<div class="content-section active" id="login-section">
    <div class="section-header-small">
        <div class="small-logo">
            <img src="{{ url_for('static', filename='images/car_logo5.png') }}"
                 alt="car diagnostics logo"
                 class="small-logo-img">
        </div>
        <div class="small-brand">
            <h3>Car_Anomaly Detection</h3>
            <p>login</p>
        </div>
    </div>

    <!-- 메인에서 돌아가는 back 버튼과는 별개 -->
    <a class="back-btn" href="{{ url_for('main.index') }}">← Back to Menu</a>

    <div class="section-header">
        <h2 class="section-title">
            {% if mode == 'signup' %}회원가입{% else %}로그인{% endif %}
        </h2>
        <p class="section-subtitle">
            {% if mode == 'signup' %}
                계정을 생성하고 마이페이지를 이용해 보세요.
            {% else %}
                등록한 이메일과 비밀번호를 입력해주세요
            {% endif %}
        </p>
    </div>

    <div class="inquiry-card" style="max-width: 480px; margin: 0 auto;">
        {% if error %}
            <p style="color:#ff5b7a; font-size:13px; margin-bottom:12px;">{{ error }}</p>
        {% endif %}

        <form method="post">

            {% if mode == 'signup' %}
            <!-- 이름 / 닉네임 -->
            <div class="contact-item" style="margin-bottom: 12px;">
                <div class="contact-details" style="width:100%;">
                    <input type="text"
                           name="name"
                           placeholder="이름 또는 닉네임"
                           style="width:100%; background:transparent; border:none; outline:none; color:#fff;">
                </div>
            </div>
            {% endif %}

            <!-- 이메일 + 중복확인 버튼 -->
            <div class="contact-item" style="margin-bottom: 12px;">
                <div class="contact-details" style="width:100%;">
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="email"
                               id="email-input"
                               name="email"
                               placeholder="이메일"
                               required
                               style="flex:1; background:transparent; border:none; outline:none; color:#fff;">

                        {% if mode == 'signup' %}
                        <!-- 중복확인 버튼 (back-btn 스타일 재사용) -->
                        <button type="button"
                                class="back-btn"
                                style="position: static;
                                       padding: 8px 14px;
                                       font-size: 11px;
                                       letter-spacing: 1px;
                                       white-space: nowrap;"
                                onclick="checkEmailDuplicate()">
                            중복확인
                        </button>
                        {% endif %}
                    </div>
                    {% if mode == 'signup' %}
                    <div id="email-check-msg"
                         style="margin-top:6px; font-size:12px; color:#aaa;">
                        <!-- 중복확인 결과 메시지 -->
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- 비밀번호 -->
            <div class="contact-item" style="margin-bottom: 16px;">
                <div class="contact-details" style="width:100%;">
                    <input type="password"
                           name="password"
                           placeholder="비밀번호"
                           required
                           style="width:100%; background:transparent; border:none; outline:none; color:#fff;">
                </div>
            </div>

            <!-- 로그인 / 회원가입 버튼: back-btn 스타일 사용 -->
            <button type="submit"
                    class="back-btn"
                    style="position: static;
                           display:block;
                           width:100%;
                           text-align:center;
                           margin-top:10px;">
                {% if mode == 'signup' %}회원가입{% else %}로그인{% endif %}
            </button>
        </form>
         <!-- 카카오로 계속하기 버튼 (로그인 버튼과 동일한 스타일) -->
         <a href="{{ url_for('auth.kakao_login') }}"
   class="back-btn social-btn kakao-btn"
   style="position: static;
          display:flex;
          align-items:center;
          justify-content:center;
          gap:8px;
          width:90%;
          margin-top:10px;
          background:#FEE500;
          color:#000;
          text-decoration:none;">
    <img src="{{ url_for('static', filename='images/kakao_logo.png') }}"
     alt="카카오"
     style="height:18px; width:auto; display:block;">
    <span>
        {% if mode == 'signup' %}
            카카오로 회원가입
        {% else %}
            카카오로 로그인
        {% endif %}
    </span>
        <a href="{{ url_for('auth.naver_login') }}"
   class="back-btn social-btn naver-btn"
   style="position: static;
          display:flex;
          align-items:center;
          justify-content:center;
          gap:8px;
          width:90%;
          margin-top:10px;
          background:#03C75A;
          color:#fff;
          text-decoration:none;">
    <img src="{{ url_for('static', filename='images/naver_logo.png') }}"
         alt="네이버"
         style="height:18px; width:auto; display:block;">
    <span>
        {% if mode == 'signup' %}
            네이버로 회원가입
        {% else %}
            네이버로 로그인
        {% endif %}
    </span>
        </a>
        

        <div style="margin-top:16px; font-size:13px; text-align:center; color:#aaa;">
            {% if mode == 'signup' %}
                이미 계정이 있나요?
                <a href="{{ url_for('auth.login') }}" style="color:#00f0ff;">로그인하기</a>
            {% else %}
                아직 회원이 아니신가요?
                <a href="{{ url_for('auth.signup') }}" style="color:#00f0ff;">회원가입</a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// 이메일 중복 확인 (회원가입 화면에서만 사용)
function checkEmailDuplicate() {
    const emailInput = document.getElementById("email-input");
    const msgEl = document.getElementById("email-check-msg");
    if (!emailInput || !msgEl) return;

    const email = emailInput.value.trim();
    if (!email) {
        msgEl.textContent = "이메일을 입력해 주세요.";
        msgEl.style.color = "#ff5b7a";
        return;
    }

    fetch("{{ url_for('auth.check_email') }}?email=" + encodeURIComponent(email))
        .then(res => res.json())
        .then(data => {
            if (!data.ok) {
                msgEl.textContent = "중복 확인 중 오류가 발생했습니다.";
                msgEl.style.color = "#ff5b7a";
                return;
            }
            if (data.exists) {
                msgEl.textContent = "이미 사용 중인 이메일입니다.";
                msgEl.style.color = "#ff5b7a";
            } else {
                msgEl.textContent = "사용 가능한 이메일입니다.";
                msgEl.style.color = "#00f0ff";
            }
        })
        .catch(err => {
            console.error(err);
            msgEl.textContent = "중복 확인 중 오류가 발생했습니다.";
            msgEl.style.color = "#ff5b7a";
        });
}
</script>
{% endblock %}
